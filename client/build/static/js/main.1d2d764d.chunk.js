(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{25:function(t,e,n){t.exports=n(64)},30:function(t,e,n){},31:function(t,e,n){},32:function(t,e,n){},33:function(t,e,n){},46:function(t,e,n){},47:function(t,e,n){},48:function(t,e,n){},49:function(t,e,n){},50:function(t,e,n){},51:function(t,e,n){},52:function(t,e,n){},53:function(t,e,n){},62:function(t,e,n){},63:function(t,e,n){},64:function(t,e,n){"use strict";n.r(e);var a=n(0),i=n.n(a),l=n(17),r=n.n(l),o=(n(30),n(6)),c=n(7),s=n(9),u=n(8),d=n(10),m=n(5),h=n(12),E=i.a.createContext({token:null,userId:null,login:function(t,e,n){},logout:function(){}}),f=(n(31),function(t){function e(t){var n;return Object(o.a)(this,e),(n=Object(s.a)(this,Object(u.a)(e).call(this,t))).switchModeHandler=function(){n.setState(function(t){return{isLogin:!t.isLogin}})},n.submitHandler=function(t){t.preventDefault();var e=n.emailEl.current.value,a=n.passwordEl.current.value;if(0!==e.trim().length&&0!==a.trim().length){var i={query:"\n\t\t\t\tquery Login($email: String!, $password: String!) {\n\t\t\t\t\tlogin(email: $email, password: $password) {\n\t\t\t\t\t\tuserId\n\t\t\t\t\t\ttoken\n\t\t\t\t\t\ttokenExpiration\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t",variables:{email:e,password:a}};n.state.isLogin||(i={query:"\n\t\t\t\t\tmutation CreateUser($email: String!, $password: String!) {\n\t\t\t\t\t\tcreateUser(userInput: {email: $email, password: $password}) {\n\t\t\t\t\t\t\t_id\n\t\t\t\t\t\t\temail\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t",variables:{email:e,password:a}}),fetch("http://localhost:3001/graphql",{method:"POST",body:JSON.stringify(i),headers:{"Content-type":"application/json"}}).then(function(t){if(200!==t.status&&201!==t.status)throw new Error("Request failed");return t.json()}).then(function(t){t.data.login.token&&n.context.login(t.data.login.token,t.data.login.userId,t.data.login.tokenExpiration)}).catch(function(t){console.log(t)})}},n.state={isLogin:!0},n.emailEl=i.a.createRef(),n.passwordEl=i.a.createRef(),n}return Object(d.a)(e,t),Object(c.a)(e,[{key:"render",value:function(){return i.a.createElement("form",{className:"auth-form",onSubmit:this.submitHandler},i.a.createElement("div",{className:"form-control"},i.a.createElement("label",{htmlFor:"E-mail"},"E-mail"),i.a.createElement("input",{type:"email",id:"email",ref:this.emailEl})),i.a.createElement("div",{className:"form-control"},i.a.createElement("label",{htmlFor:"Password"},"Password"),i.a.createElement("input",{type:"password",id:"password",ref:this.passwordEl})),i.a.createElement("div",{className:"form-actions"},i.a.createElement("button",{type:"submit"},"Submit"),i.a.createElement("button",{type:"button",onClick:this.switchModeHandler},this.state.isLogin?"Signup":"Login"," ")))}}]),e}(i.a.Component));f.contextType=E;var v=f,p=(n(32),function(){return i.a.createElement("div",{className:"spinner"},i.a.createElement("div",{className:"lds-ellipsis"},i.a.createElement("div",null),i.a.createElement("div",null),i.a.createElement("div",null),i.a.createElement("div",null)))}),g=(n(33),function(t){return i.a.createElement("ul",{className:"bookings-list"},t.bookings.map(function(e){return i.a.createElement("li",{key:e._id,className:"bookings-item"},i.a.createElement("div",{className:"bookings-item-data"},e.event.title," -"," ",new Date(e.createdAt).toLocaleDateString()),i.a.createElement("div",{className:"bookings-item-actions"},i.a.createElement("button",{className:"btn",onClick:t.onDelete.bind(void 0,e._id)},"Cancel")))}))}),b=n(14),k=n(22),w={Cheap:{min:0,max:50},Normal:{min:50,max:200},Expensive:{min:200,max:1e9}},C=function(t){var e={labels:[],datasets:[]},n=[],a=function(a){var i=t.bookings.reduce(function(t,e){return e.event.price>w[a].min&&e.event.price<w[a].max?t+1:t},0);n.push(i),e.labels.push(a),e.datasets.push({fillColor:"rgba(220,220,220,0.5)",strokeColor:"rgba(220,220,220,0.8)",highlightFill:"rgba(220,220,220,0.75)",highlightStroke:"rgba(220,220,220,1)",data:n}),(n=Object(b.a)(n))[n.length-1]=0};for(var l in w)a(l);return i.a.createElement("div",{style:{textAlign:"center"}},i.a.createElement(k.Bar,{data:e}))},y=(n(46),function(t){return i.a.createElement("div",{className:"bookings-control"},i.a.createElement("button",{className:"list"===t.activeButton?"active":"",onClick:t.activeOutput.bind(void 0,"list")},"List"),i.a.createElement("button",{className:"chart"===t.activeButton?"active":"",onClick:t.activeOutput.bind(void 0,"chart")},"Chart"))}),S=function(t){function e(t){var n;return Object(o.a)(this,e),(n=Object(s.a)(this,Object(u.a)(e).call(this,t))).fecthBookings=function(){n.setState({isLoading:!0});fetch("http://localhost:3001/graphql",{method:"POST",body:JSON.stringify({query:"\n\t\t\t\t\tquery {\n\t\t\t\t\t\tbookings {\n\t\t\t\t\t\t\t_id\n\t\t\t\t\t\t\tcreatedAt\n\t\t\t\t\t\t\tevent {\n\t\t\t\t\t\t\t\t_id\n\t\t\t\t\t\t\t\ttitle\n\t\t\t\t\t\t\t\tdate\n\t\t\t\t\t\t\t\tprice\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t"}),headers:{"Content-type":"application/json",Authorization:"Bearer "+n.context.token}}).then(function(t){if(200!==t.status&&201!==t.status)throw new Error("Request failed");return t.json()}).then(function(t){var e=t.data.bookings;n.setState({bookings:e,isLoading:!1})}).catch(function(t){console.log(t),n.setState({isLoading:!1})})},n.showDetailHandler=function(t){n.setState(function(e){return{selectedEvent:e.events.find(function(e){return e._id===t})}})},n.deleteBookingHandler=function(t){n.setState({isLoading:!0});var e={query:"\n\t\t\t\t\tmutation DeleteBooking($id: ID!) {\n\t\t\t\t\t\tcancelBooking(bookingId: $id) {\n\t\t\t\t\t\t\t_id\n\t\t\t\t\t\t\ttitle\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t",variables:{id:t}};fetch("http://localhost:3001/graphql",{method:"POST",body:JSON.stringify(e),headers:{"Content-type":"application/json",Authorization:"Bearer "+n.context.token}}).then(function(t){if(200!==t.status&&201!==t.status)throw new Error("Request failed");return t.json()}).then(function(e){n.setState(function(e){return{bookings:e.bookings.filter(function(e){return e._id!==t}),isLoading:!1}})}).catch(function(t){console.log(t),n.setState({isLoading:!1})})},n.outputHandler=function(t){"list"===t?n.setState({output:"list"}):n.setState({output:"chart"})},n.state={isLoading:!1,bookings:[],output:"list"},n}return Object(d.a)(e,t),Object(c.a)(e,[{key:"componentDidMount",value:function(){this.fecthBookings()}},{key:"render",value:function(){var t=i.a.createElement(p,null);return this.state.isLoading||(t=i.a.createElement(i.a.Fragment,null,i.a.createElement(y,{activeButton:this.state.output,activeOutput:this.outputHandler}),i.a.createElement("div",null,"list"===this.state.output?i.a.createElement(g,{bookings:this.state.bookings,onDelete:this.deleteBookingHandler}):i.a.createElement(C,{bookings:this.state.bookings})))),i.a.createElement(i.a.Fragment,null,t)}}]),e}(i.a.Component);S.contextType=E;var N=S,O=(n(47),function(t){return i.a.createElement("div",{className:"modal"},i.a.createElement("header",{className:"modal-header"},i.a.createElement("h1",null,t.title)),i.a.createElement("section",{className:"modal-content"},t.children),i.a.createElement("section",{className:"modal-actions"},t.canCancel&&i.a.createElement("button",{className:"btn",onClick:t.onCancel},"Cancel"),t.canConfirm&&i.a.createElement("button",{className:"btn",onClick:t.onConfirm},t.confirmText)))}),j=(n(48),function(t){return i.a.createElement("div",{className:"backdrop",onClick:t.click})}),x=(n(49),function(t){return i.a.createElement("li",{key:t.eventId,className:"events-list-item"},i.a.createElement("div",null,i.a.createElement("h1",null,t.title),i.a.createElement("h2",null,"$",t.price," - ",new Date(t.date).toLocaleDateString())),i.a.createElement("div",null,t.userId===t.creatorId?i.a.createElement("p",null,"your the owner of this event"):i.a.createElement("button",{className:"btn",onClick:t.onDetail.bind(void 0,t.eventId)},"View Details")))}),L=(n(50),function(t){var e=t.events.map(function(e){return i.a.createElement(x,{key:e._id,eventId:e._id,title:e.title,price:e.price,date:e.date,userId:t.userId,creatorId:e.creator._id,onDetail:t.viewDetails})});return i.a.createElement("ul",{className:"event-list"},e)}),I=(n(51),function(t){function e(t){var n;return Object(o.a)(this,e),(n=Object(s.a)(this,Object(u.a)(e).call(this,t))).isActive=!0,n.createEventHandler=function(){n.setState({creating:!0})},n.modalConfirmHandler=function(){n.setState({creating:!1});var t=n.titleEl.current.value,e=+n.priceEl.current.value,a=n.dateEl.current.value,i=n.descriptionEl.current.value;if(!(0===t.trim().length||e<=0||0===a.trim().length||0===i.trim().length)){var l={title:t,price:e,date:a,description:i};console.log(l);var r={query:"\n\t\t\t\t\tmutation CreateEvent($title: String!, $description: String!, $price: Float!, $date: String!) {\n\t\t\t\t\t\tcreateEvent(eventInput: {title: $title, description: $description, price: $price, date: $date}) {\n\t\t\t\t\t\t\t_id\n\t\t\t\t\t\t\ttitle\n\t\t\t\t\t\t\tdate\n\t\t\t\t\t\t\tprice\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t",variables:{title:t,description:i,price:e,date:a}},o=n.context.token;fetch("http://localhost:3001/graphql",{method:"POST",body:JSON.stringify(r),headers:{"Content-type":"application/json",Authorization:"Bearer "+o}}).then(function(t){if(200!==t.status&&201!==t.status)throw new Error("Request failed");return t.json()}).then(function(t){n.setState(function(e){var a=Object(b.a)(e.events);return a.push({_id:t.data.createEvent._id,title:t.data.createEvent.title,description:t.data.createEvent.description,date:t.data.createEvent.date,price:t.data.createEvent.price,creator:{_id:n.context.userId}}),{events:a}})}).catch(function(t){console.log(t)})}},n.modalCancelHandler=function(){n.setState({creating:!1,selectedEvent:null})},n.showDetailHandler=function(t){n.setState(function(e){return{selectedEvent:e.events.find(function(e){return e._id===t})}})},n.bookEventHandler=function(){if(n.context.token){var t={query:"\n\t\t\t\t\tmutation BookEvent($id: ID!) {\n\t\t\t\t\t\tbookEvent(eventId: $id) {\n\t\t\t\t\t\t\t_id\n\t\t\t\t\t\t\tcreatedAt\n\t\t\t\t\t\t\tupdatedAt\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t",variables:{id:n.state.selectedEvent._id}};fetch("http://localhost:3001/graphql",{method:"POST",body:JSON.stringify(t),headers:{"Content-type":"application/json",Authorization:"Bearer "+n.context.token}}).then(function(t){if(200!==t.status&&201!==t.status)throw new Error("Request failed");return t.json()}).then(function(t){console.log(t),n.setState({selectedEvent:null})}).catch(function(t){console.log(t)})}else n.setState({selectedEvent:null})},n.state={creating:!1,events:[],isLoading:!1,selectedEvent:null},n.titleEl=i.a.createRef(),n.priceEl=i.a.createRef(),n.dateEl=i.a.createRef(),n.descriptionEl=i.a.createRef(),n}return Object(d.a)(e,t),Object(c.a)(e,[{key:"componentDidMount",value:function(){this.fetchEvents()}},{key:"fetchEvents",value:function(){var t=this;this.setState({isLoading:!0});fetch("http://localhost:3001/graphql",{method:"POST",body:JSON.stringify({query:"\n\t\t\t\t\tquery {\n\t\t\t\t\t\tevents {\n\t\t\t\t\t\t\t_id\n\t\t\t\t\t\t\ttitle\n\t\t\t\t\t\t\tdate\n\t\t\t\t\t\t\tprice\n\t\t\t\t\t\t\tcreator {\n\t\t\t\t\t\t\t\t_id\n\t\t\t\t\t\t\t\temail\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t"}),headers:{"Content-type":"application/json"}}).then(function(t){if(200!==t.status&&201!==t.status)throw new Error("Request failed");return t.json()}).then(function(e){var n=e.data.events;t.isActive&&t.setState({events:n,isLoading:!1})}).catch(function(e){t.isActive&&t.setState({isLoading:!1})})}},{key:"componentWillUnmount",value:function(){this.isActive=!1}},{key:"render",value:function(){return i.a.createElement(i.a.Fragment,null,(this.state.creating||this.state.selectedEvent)&&i.a.createElement(j,null),this.state.creating&&i.a.createElement(O,{title:"Add Event",canCancel:!0,canConfirm:!0,onCancel:this.modalCancelHandler,onConfirm:this.modalConfirmHandler,confirmText:"Confirm"},i.a.createElement("form",null,i.a.createElement("div",{className:"form-control"},i.a.createElement("label",{htmlFor:"title"},"Title"),i.a.createElement("input",{type:"text",id:"title",ref:this.titleEl})),i.a.createElement("div",{className:"form-control"},i.a.createElement("label",{htmlFor:"price"},"Price"),i.a.createElement("input",{type:"number",id:"price",ref:this.priceEl})),i.a.createElement("div",{className:"form-control"},i.a.createElement("label",{htmlFor:"date"},"Date"),i.a.createElement("input",{type:"datetime-local",id:"date",ref:this.dateEl})),i.a.createElement("div",{className:"form-control"},i.a.createElement("label",{htmlFor:"description"},"Description"),i.a.createElement("textarea",{id:"description",rows:"4",ref:this.descriptionEl})))),this.state.selectedEvent&&i.a.createElement(O,{title:this.state.selectedEvent.title,canCancel:!0,canConfirm:!0,onCancel:this.modalCancelHandler,onConfirm:this.bookEventHandler,confirmText:this.context.token?"Book":"Confirm"},i.a.createElement("h1",null,this.state.selectedEvent.title),i.a.createElement("h2",null,"$",this.state.selectedEvent.price," -"," ",new Date(this.state.selectedEvent.date).toLocaleDateString()),i.a.createElement("p",null,this.state.selectedEvent.description)),this.context.token&&i.a.createElement("div",{className:"events-control"},i.a.createElement("p",null,"Share your own Events!"),i.a.createElement("button",{className:"btn",onClick:this.createEventHandler},"Create Event")),this.state.isLoading?i.a.createElement(p,null):i.a.createElement(L,{events:this.state.events,userId:this.context.userId,viewDetails:this.showDetailHandler}))}}]),e}(i.a.Component));I.contextType=E;var D=I,H=(n(52),function(t){return i.a.createElement("button",{className:"drawer-button",onClick:t.click},i.a.createElement("div",{className:"button-line"}),i.a.createElement("div",{className:"button-line"}),i.a.createElement("div",{className:"button-line"}))}),q=(n(53),function(t){return i.a.createElement(E.Consumer,null,function(e){return i.a.createElement("header",{className:"main-navigation"},i.a.createElement(H,{click:t.drawerClick}),i.a.createElement("div",{className:"main-navigation-logo"},i.a.createElement("h1",null,"EventBooking")),i.a.createElement("div",{className:"main-navigation-items"},i.a.createElement("ul",null,!e.token&&i.a.createElement("li",null,i.a.createElement(m.b,{to:"/auth"},"Login")),i.a.createElement("li",null,i.a.createElement(m.b,{to:"/events"},"Events")),e.token&&i.a.createElement(i.a.Fragment,null,i.a.createElement("li",null,i.a.createElement(m.b,{to:"/bookings"},"Bookings")),i.a.createElement("li",null,i.a.createElement("button",{onClick:e.logout},"Logout"))))))})}),$=(n(62),function(t){var e="side-drawer";return t.show&&(e="side-drawer open"),i.a.createElement(E.Consumer,null,function(t){return i.a.createElement("nav",{className:e},i.a.createElement("ul",null,!t.token&&i.a.createElement("li",null,i.a.createElement(m.b,{to:"/auth"},"Login")),i.a.createElement("li",null,i.a.createElement(m.b,{to:"/events"},"Events")),t.token&&i.a.createElement(i.a.Fragment,null,i.a.createElement("li",null,i.a.createElement(m.b,{to:"/bookings"},"Bookings")),i.a.createElement("li",null,i.a.createElement("button",{onClick:t.logout},"Logout")))))})}),B=(n(63),function(t){function e(){var t,n;Object(o.a)(this,e);for(var a=arguments.length,i=new Array(a),l=0;l<a;l++)i[l]=arguments[l];return(n=Object(s.a)(this,(t=Object(u.a)(e)).call.apply(t,[this].concat(i)))).state={token:null,userId:null,drawerOpen:!1},n.login=function(t,e,a){n.setState({token:t,userId:e})},n.logout=function(){n.setState({token:null,userId:null})},n.drawerClickHandler=function(){n.setState(function(t){return{drawerOpen:!t.drawerOpen}})},n.backdropClickHandler=function(){n.setState({drawerOpen:!1})},n}return Object(d.a)(e,t),Object(c.a)(e,[{key:"render",value:function(){var t;return this.state.drawerOpen&&(t=i.a.createElement(j,{click:this.backdropClickHandler})),i.a.createElement(m.a,null,i.a.createElement(i.a.Fragment,null,i.a.createElement(E.Provider,{value:{token:this.state.token,userId:this.state.userId,login:this.login,logout:this.logout}},i.a.createElement("div",{className:"content-section"},i.a.createElement(q,{drawerClick:this.drawerClickHandler}),i.a.createElement($,{show:this.state.drawerOpen}),t,i.a.createElement("main",{className:"main-content"},i.a.createElement(h.d,null,this.state.token&&i.a.createElement(h.a,{from:"/",to:"/events",exact:!0}),this.state.token&&i.a.createElement(h.a,{from:"/auth",to:"/events",exact:!0}),!this.state.token&&i.a.createElement(h.b,{path:"/auth",component:v}),i.a.createElement(h.b,{path:"/events",component:D}),this.state.token&&i.a.createElement(h.b,{path:"/bookings",component:N}),!this.state.token&&i.a.createElement(h.a,{to:"/auth",exact:!0})))))))}}]),e}(i.a.Component));r.a.render(i.a.createElement(B,null),document.getElementById("root"))}},[[25,1,2]]]);
//# sourceMappingURL=main.1d2d764d.chunk.js.map